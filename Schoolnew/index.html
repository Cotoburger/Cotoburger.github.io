<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="theme-color" id="themeColor" content="#87CEEB" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link rel="shortcut icon" href="icons/icon-dark3x.png" />
    <link
      rel="apple-touch-icon"
      href="icons/icon-dark1x.png"
      media="(prefers-color-scheme: dark)"
      sizes="128x128"
    />
    <link
      rel="apple-touch-icon"
      href="icons/icon-dark2x.png"
      media="(prefers-color-scheme: dark)"
      sizes="256x256"
    />
    <link
      rel="apple-touch-icon"
      href="icons/icon-dark3x.png"
      media="(prefers-color-scheme: dark)"
      sizes="384x384"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <meta property="og:title" content="Schedule" />
    <meta
      property="og:description"
      content="Расписание звонков в МАОУ Средняя школа №1"
    />
    <meta
      property="og:image"
      content="https://cotoburger.github.io/Schoolnew//icons/icon.svg"
    />
    <meta property="og:url" content="https://cotoburger.github.io/Schoolnew/" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Schedule" />
    <meta
      name="twitter:description"
      content="Расписание звонков в МАОУ Средняя школа №1 v2"
    />
    <meta
      name="twitter:image"
      content="https://cotoburger.github.io/Schoolnew//icons/icon.svg"
    />
    <meta
      name="twitter:url"
      content="https://cotoburger.github.io/Schoolnew/"
    />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icons/icon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css" />
    <title>Расписание уроков</title>
    
  </head>
  <body>
    <!-- Day Header -->
    <div class="day-header" id="dayOfWeek"></div>
    <div class="container">
      <!-- Lesson Cards -->
      <div class="lesson-card">
        <div class="shift-number">1 смена</div>
        <div class="lesson-header">
          <div id="lesson1-name"></div>
          <div id="lesson1-remaining">
            <span class="hourglass-icon">
              <svg
                width="20"
                height="20"
                viewBox="0 0 21 21"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M19 3H5C4.44772 3 4 3.44772 4 4V6.58579C4 7.11622 4.21071 7.62493 4.58579 8L8 11.4142V12.5858L4.58579 16C4.21071 16.3751 4 16.8838 4 17.4142V20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20V17.4142C20 16.8838 19.7893 16.3751 19.4142 16L16 12.5858V11.4142L19.4142 8C19.7893 7.62493 20 7.11622 20 6.58579V4C20 3.44772 19.5523 3 19 3ZM18 6H6V5H18V6ZM12 11V13L15.4142 16.4142C15.7893 16.7893 16 17.298 16 17.8284V19H8V17.8284C8 17.298 8.21071 16.7893 8.58579 16.4142L12 13V11Z"
                  fill="currentColor"
                />
              </svg>
            </span>
            <span class="remaining-text"></span>
          </div>
        </div>
        <div class="progress-time-labels">
          <span id="lesson1-start-time"></span>
          <span id="lesson1-end-time"></span>
        </div>
        <div class="progress-bar">
          <div id="lesson1-progress"></div>
        </div>
      </div>
      <div class="lesson-card">
        <div class="shift-number">2 смена</div>
        <div class="lesson-header">
          <div id="lesson2-name"></div>
          <div id="lesson2-remaining">
            <span class="hourglass-icon">
              <svg
                width="20"
                height="20"
                viewBox="0 0 21 21"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M19 3H5C4.44772 3 4 3.44772 4 4V6.58579C4 7.11622 4.21071 7.62493 4.58579 8L8 11.4142V12.5858L4.58579 16C4.21071 16.3751 4 16.8838 4 17.4142V20C4 20.5523 4.44772 21 5 21H19C19.5523 21 20 20.5523 20 20V17.4142C20 16.8838 19.7893 16.3751 19.4142 16L16 12.5858V11.4142L19.4142 8C19.7893 7.62493 20 7.11622 20 6.58579V4C20 3.44772 19.5523 3 19 3ZM18 6H6V5H18V6ZM12 11V13L15.4142 16.4142C15.7893 16.7893 16 17.298 16 17.8284V19H8V17.8284C8 17.298 8.21071 16.7893 8.58579 16.4142L12 13V11Z"
                  fill="currentColor"
                />
              </svg>
            </span>
            <span class="remaining-text"></span>
          </div>
        </div>
        <div class="progress-time-labels">
          <span id="lesson2-start-time"></span>
          <span id="lesson2-end-time"></span>
        </div>
        <div class="progress-bar">
          <div id="lesson2-progress"></div>
        </div>
      </div>
      <div class="lesson-card">
        <!-- Таблица питания -->
        <div id="meal-table-container" style="margin-top:0.3rem;"></div>
      </div>
    </div>
    <div class="container">
      <div class="lesson-card-full">
        <button class="open-full-schedule">
          <svg
            width="20.000000"
            height="20.000000"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
          >
            <desc>Created with Pixso.</desc>
            <defs />
            <rect
              id="Прямоугольник 18"
              x="1.000000"
              y="1.000000"
              rx="7.000000"
              width="18.000000"
              height="18.000000"
              stroke="currentColor"
              stroke-width="2.000000"
            />
            <path
              id="Стрелка 1"
              d="M13.14 7.55L6.08 15.49C5.77 15.84 5.24 15.87 4.88 15.56C4.53 15.24 4.5 14.71 4.81 14.36L11.87 6.42L7.13 6.7C6.66 6.73 6.26 6.37 6.23 5.9C6.21 5.42 6.56 5.03 7.03 5L13.82 4.6C14.3 4.57 14.69 4.92 14.72 5.4L15.12 12.19C15.15 12.66 14.8 13.06 14.32 13.09C13.84 13.11 13.45 12.76 13.42 12.29L13.14 7.55Z"
              fill="currentColor"
            />
          </svg>
        </button>
        <div class="schedule-header">Расписание</div>
        <div class="full-schedule-container">
          <div class="shift-schedule">
            <div class="schedule-index">1 смена</div>
            <div id="shift1-full"></div>
          </div>
          <div class="shift-schedule">
            <div class="schedule-index">2 смена</div>
            <div id="shift2-full"></div>
          </div>
          <div class="shift-schedule">
            <div class="schedule-index">Питание</div>
            <div id="meals-full"></div>
          </div>
        </div>
      </div>
    </div>
    <p id="last-deployment">Getting data...</p>
    <!-- Full Schedule Panel -->
    <div class="full-schedule-panel" style="display: none">
      <div class="panel-content">
        <button class="close-panel">
          <svg
            width="25.000000"
            height="25.000000"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
          >
            <desc>Created with Pixso.</desc>
            <defs />
            <rect
              id="Прямоугольник 18"
              x="1.000000"
              y="1.000000"
              rx="7.000000"
              width="18.000000"
              height="18.000000"
              stroke="currentColor"
              stroke-width="2.000000"
            />
            <line
              id="Линия 1"
              x1="5.000000"
              y1="15.000000"
              x2="15.000000"
              y2="5.000000"
              stroke="currentColor"
              stroke-width="2.000000"
            />
            <path
              id="Линия 1"
              d="M15 15L5 5"
              stroke="currentColor"
              stroke-width="2.000000"
              stroke-linecap="round"
            />
          </svg>
        </button>
        <div class="day-navigation">
          <button id="prevDay"><</button>
          <h2 id="currentDayTitle">Расписание</h2>
          <button id="nextDay">></button>
        </div>
        <div class="schedule-slider" id="scheduleSlider">
          <!-- Days will be dynamically added here -->
        </div>
      </div>
    </div>
    <script>
      (function () {
        function updateVh() {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty("--vh", vh + "px");
        }
        function resetScroll() {
          window.scrollTo(0, 0);
          document.documentElement.scrollTop = 0;
          document.body.scrollTop = 0;
        }
        let userScrolled = false;
        window.addEventListener(
          "scroll",
          () => {
            userScrolled = true;
          },
          { once: true, passive: true }
        );
        if ("scrollRestoration" in history) {
          try {
            history.scrollRestoration = "manual";
          } catch (e) {}
        }
        // при загрузке страницы один раз сбросим скролл
        window.addEventListener("load", () => {
          updateVh();
          if (!userScrolled) {
            resetScroll();
            // дополнительная страховка, если юзер ещё не успел крутить
            setTimeout(() => {
              if (!userScrolled) resetScroll();
            }, 100);
          }
        });
        // при ресайзе и смене ориентации обновляем vh
        window.addEventListener("resize", updateVh, { passive: true });
        window.addEventListener(
          "orientationchange",
          () => {
            updateVh();
            if (!userScrolled) resetScroll();
          },
          { passive: true }
        );
      })();
    </script>
    <script>
      const lessons1 = 0;
      const lessons2 = 0;
      const reasons = {
        0: null,
        1: "Занятия отменены из за плохой погоды",
        2: "Уроков нет по техническим причинам",
        3: "Уроков нет — каникулы ☺",
        4: "Кимпинтяо",
        5: "Чупапимуняню",
        6: "Уроков нет — день самоуправления",
        7: "/Schoolnew/icons/icon-dark1x.png",
      };
      // ================================================
      const schedule = {
        1: {
          shift1: [
            { lesson: "Классный час", start: "08:15", end: "08:45" },
            { lesson: "1-й урок", start: "08:55", end: "09:35" },
            { lesson: "2-й урок", start: "09:50", end: "10:30" },
            { lesson: "3-й урок", start: "10:45", end: "11:25" },
            { lesson: "4-й урок", start: "11:30", end: "12:10" },
            { lesson: "5-й урок", start: "12:20", end: "13:00" },
            { lesson: "6-й урок", start: "13:20", end: "14:00" },
            { lesson: "7-й урок", start: "14:15", end: "14:55" },
          ],
          shift2: [
            { lesson: "0-й урок", start: "12:20", end: "13:00" },
            { lesson: "1-й урок", start: "13:20", end: "14:00" },
            { lesson: "2-й урок", start: "14:15", end: "14:55" },
            { lesson: "3-й урок", start: "15:10", end: "15:50" },
            { lesson: "Классный час", start: "16:05", end: "16:35" },
            { lesson: "4-й урок", start: "16:40", end: "17:20" },
            { lesson: "5-й урок", start: "17:30", end: "18:10" },
            { lesson: "6-й урок", start: "18:20", end: "19:00" },
          ],
        },
        2: {
          shift1: [
            { lesson: "1-й урок", start: "08:15", end: "08:55" },
            { lesson: "2-й урок", start: "09:05", end: "09:45" },
            { lesson: "3-й урок", start: "10:00", end: "10:40" },
            { lesson: "4-й урок", start: "11:00", end: "11:40" },
            { lesson: "5-й урок", start: "11:50", end: "12:30" },
            { lesson: "6-й урок", start: "12:50", end: "13:30" },
            { lesson: "7-й урок", start: "13:50", end: "14:30" },
          ],
          shift2: [
            { lesson: "0-й урок", start: "11:50", end: "12:30" },
            { lesson: "1-й урок", start: "12:50", end: "13:30" },
            { lesson: "2-й урок", start: "13:50", end: "14:30" },
            { lesson: "3-й урок", start: "14:45", end: "15:25" },
            { lesson: "4-й урок", start: "15:40", end: "16:20" },
            { lesson: "5-й урок", start: "16:30", end: "17:10" },
            { lesson: "6-й урок", start: "17:20", end: "18:00" },
          ],
        },
        3: {
          shift1: [
            { lesson: "1-й урок", start: "08:15", end: "08:55" },
            { lesson: "2-й урок", start: "09:05", end: "09:45" },
            { lesson: "3-й урок", start: "10:00", end: "10:40" },
            { lesson: "Классный час", start: "10:55", end: "11:25" },
            { lesson: "4-й урок", start: "11:30", end: "12:10" },
            { lesson: "5-й урок", start: "12:20", end: "13:00" },
            { lesson: "6-й урок", start: "13:20", end: "14:00" },
            { lesson: "7-й урок", start: "14:15", end: "14:55" },
          ],
          shift2: [
            { lesson: "0-й урок", start: "12:20", end: "13:00" },
            { lesson: "1-й урок", start: "13:20", end: "14:00" },
            { lesson: "2-й урок", start: "14:15", end: "14:55" },
            { lesson: "3-й урок", start: "15:10", end: "15:50" },
            { lesson: "Классный час", start: "16:05", end: "16:35" },
            { lesson: "4-й урок", start: "16:40", end: "17:20" },
            { lesson: "5-й урок", start: "17:30", end: "18:10" },
            { lesson: "6-й урок", start: "18:20", end: "19:00" },
          ],
        },
        4: {
          shift1: [
            { lesson: "1-й урок", start: "08:15", end: "08:55" },
            { lesson: "2-й урок", start: "09:05", end: "09:45" },
            { lesson: "3-й урок", start: "10:00", end: "10:40" },
            { lesson: "Классный час", start: "10:55", end: "11:25" },
            { lesson: "4-й урок", start: "11:30", end: "12:10" },
            { lesson: "5-й урок", start: "12:20", end: "13:00" },
            { lesson: "6-й урок", start: "13:20", end: "14:00" },
            { lesson: "7-й урок", start: "14:15", end: "14:55" },
          ],
          shift2: [
            { lesson: "0-й урок", start: "12:20", end: "13:00" },
            { lesson: "1-й урок", start: "13:20", end: "14:00" },
            { lesson: "2-й урок", start: "14:15", end: "14:55" },
            { lesson: "3-й урок", start: "15:10", end: "15:50" },
            { lesson: "Классный час", start: "16:05", end: "16:35" },
            { lesson: "4-й урок", start: "16:40", end: "17:20" },
            { lesson: "5-й урок", start: "17:30", end: "18:10" },
            { lesson: "6-й урок", start: "18:20", end: "19:00" },
          ],
        },
        5: {
          shift1: [
            { lesson: "1-й урок", start: "08:15", end: "08:55" },
            { lesson: "2-й урок", start: "09:05", end: "09:45" },
            { lesson: "3-й урок", start: "10:00", end: "10:40" },
            { lesson: "4-й урок", start: "11:00", end: "11:40" },
            { lesson: "5-й урок", start: "11:50", end: "12:30" },
            { lesson: "6-й урок", start: "12:50", end: "13:30" },
            { lesson: "7-й урок", start: "13:50", end: "14:30" },
          ],
          shift2: [
            { lesson: "0-й урок", start: "11:50", end: "12:30" },
            { lesson: "1-й урок", start: "12:50", end: "13:30" },
            { lesson: "2-й урок", start: "13:50", end: "14:30" },
            { lesson: "3-й урок", start: "14:45", end: "15:25" },
            { lesson: "4-й урок", start: "15:40", end: "16:20" },
            { lesson: "5-й урок", start: "16:30", end: "17:10" },
            { lesson: "6-й урок", start: "17:20", end: "18:00" },
          ],
        },
        6: {
          shift1: [],
          shift2: [],
        },
        0: {
          shift1: [],
          shift2: [],
       },
      };

      let lastUpdateTime = 0;
        const UPDATE_INTERVAL = 3600000; // 1 час в миллисекундах

        function updateMealDisplay() {
        // Загружаем меню из файла
        async function loadFoodMenu() {
          try {
            const resp = await fetch("./foodmenu.txt", { cache: "no-store" });
            const text = await resp.text();
            const lines = text.split("\n").map(l => l.trim()).filter(l => l);
            const food = {};
            lines.forEach(line => {
              const [meal, items] = line.split(":");
              food[meal] = items.split(",").map(i => i.trim());
            });
            return food;
          } catch (e) {
            console.error("Не удалось загрузить foodmenu.txt", e);
            return null;
          }
        }
        // Рисуем таблицу
        async function renderMealTable() {
          const tableContainer = document.getElementById("meal-table-container");
          if (!tableContainer) return;
          const currentTime = Date.now();
          if (currentTime - lastUpdateTime < UPDATE_INTERVAL) {
            return; // Не обновляем и не трогаем контейнер, оставляем текущую таблицу
          }
          // Рендерим заглушку только когда собираемся обновлять данные
          renderPlaceholderTable(tableContainer);
          lastUpdateTime = currentTime;
          let food = await loadFoodMenu();
          if (food === null) {
            food = {}; // Используем пустой объект для отображения пустой таблицы
          }
          // Забираем дату, если есть
          const menuDate = food["Дата меню"] || null;
          if (menuDate) delete food["Дата меню"];
          let dateLabel = menuDate ? ` (${menuDate})` : "";
          let tableHtml = `
            <table class="meal-table" style="
              width:100%;
              border-collapse:collapse;
              font-size:1.1em;
              background:rgba(255,255,255,0.13);
              border-radius:0.7em;
              overflow:hidden;
            ">
            <thead>
              <tr style="background:rgba(0,0,0,0.07);font-weight:600;border-bottom:1px solid rgba(255,255,255,0.12);">
                <th style="padding:0.4em 0.2em;">Приём пищи</th>
                <th style="padding:0.4em 0.2em;">Меню${dateLabel}</th>
              </tr>
            </thead>
            <tbody>
          `;
          const order = ["Завтрак", "Обед", "Полдник"];
          order.forEach(meal => {
            const addBorder = meal !== "Полдник";
            const menuItems = food[meal] ? food[meal].join(", ") : "";
            tableHtml += `
              <tr style="${addBorder ? 'border-bottom:1px solid rgba(255,255,255,0.1);' : ''}">
                <td style="padding:0.6em 0.3em;">${meal}</td>
                <td style="padding:0.6em 0.3em;">${menuItems}</td>
              </tr>
            `;
            if (meal === "Полдник") {
              tableHtml += `
                <tr>
                  <td colspan="2" style="padding:0.8em 0;"></td>
                </tr>
              `;
            }
          });
          tableHtml += `</tbody></table>`;
          // Анимация замены заглушки на данные
          tableContainer.style.transition = 'height 0.3s ease-in-out';
          tableContainer.style.overflow = 'hidden';
          const currentHeight = tableContainer.offsetHeight;
          tableContainer.style.height = `${currentHeight}px`;
          // Принудительный reflow для запуска анимации
          tableContainer.offsetHeight;
          // Устанавливаем новый контент
          tableContainer.innerHTML = tableHtml;
          // Получаем новую высоту
          const newHeight = tableContainer.scrollHeight;
          // Анимируем к новой высоте
          tableContainer.style.height = `${newHeight}px`;
          // После анимации сбрасываем стили
          setTimeout(() => {
            tableContainer.style.height = '';
            tableContainer.style.overflow = '';
            tableContainer.style.transition = '';
          }, 300);
        }
        // Функция для рендеринга заглушки
        function renderPlaceholderTable(container) {
          let tableHtml = `
            <table class="meal-table" style="
              width:100%;
              border-collapse:collapse;
              font-size:1.1em;
              background:rgba(255,255,255,0.13);
              border-radius:0.7em;
              overflow:hidden;
            ">
            <thead>
              <tr style="background:rgba(0,0,0,0.07);font-weight:600;border-bottom:1px solid rgba(255,255,255,0.12);">
                <th style="padding:0.4em 0.2em;">Приём<br>пищи</th>
                <th style="padding:0.4em 0.2em;">Меню(xx.xx.xxxx)</th>
              </tr>
            </thead>
          </table>`;
          container.innerHTML = tableHtml;
        }
        // Запуск
        renderMealTable();
      }
      // Обновленный вызов в функции updateSchedule
      try {
        if (!(lessons1 !== 0 && lessons2 !== 0)) {
          updateMealDisplay();
        }
      } catch (e) {
        console.warn("Meal update failed", e);
      }
      function findNextSimpleTimeDiff(targetTimeStr, currentTimeStr) {
        const now = new Date();
        const [th, tm] = targetTimeStr.split(":").map(Number);
        const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), th, tm, 0);
        const localNow = new Date();
        const diffSec = Math.floor((target - localNow) / 1000);
        if (diffSec <= 0) return "0 мин";
        return formatTimeDifference(diffSec);
      }
      function applyNoLessonsReasonToShifts() {
        const shift1Card = document.querySelector(".lesson-card:nth-child(1)");
        const shift2Card = document.querySelector(".lesson-card:nth-child(2)");
        // Функция для генерации контента
        function getReasonContent(reasonId) {
          const reason = reasons[reasonId];
          if (!reason) return "";
          // === 1. Если это HTML (начинается с <) ===
          if (typeof reason === "string" && reason.trim().startsWith("<")) {
            return reason; // Вставляем как есть (с картинкой, стилями и т.д.)
          }
          // === 2. Если это URL картинки ===
          if (
            typeof reason === "string" &&
            (reason.startsWith("http") ||
              reason.startsWith("/") ||
              reason.startsWith("./"))
          ) {
            return `<img src="${reason}" alt="Причина отмены" class="no-lessons-image">`;
          }
          // === 3. Обычный текст ===
          return `<div class="no-lessons-message-text">${reason}</div>`;
        }
        // 1-я смена
        if (lessons1 !== 0 && shift1Card) {
          const content = getReasonContent(lessons1);
          shift1Card.innerHTML = `
            <div class="no-lessons-header">1 смена</div>
            <div class="no-lessons-content">${content}</div>
        `;
          shift1Card.classList.remove("collapsed");
          shift1Card.classList.add("no-lessons");
        } else if (shift1Card) {
          shift1Card.classList.remove("no-lessons");
        }
        // 2-я смена
        if (lessons2 !== 0 && shift2Card) {
          const content = getReasonContent(lessons2);
          shift2Card.innerHTML = `
            <div class="no-lessons-header">2 смена</div>
            <div class="no-lessons-content">${content}</div>
        `;
          shift2Card.classList.remove("collapsed");
          shift2Card.classList.add("no-lessons");
        } else if (shift2Card) {
          shift2Card.classList.remove("no-lessons");
        }
        // body.no-lessons
        if (lessons1 !== 0 || lessons2 !== 0) {
          document.body.classList.add("no-lessons");
        } else {
          document.body.classList.remove("no-lessons");
        }
        // Если уроки отменены у ОБЕИХ смен — питания вообще нет: скрываем карточку питания.
        const mealCard = document.querySelectorAll(".lesson-card")[2];
        if (mealCard) {
          if (lessons1 !== 0 && lessons2 !== 0) {
            mealCard.style.display = "none";
          } else {
            // Восстанавливаем видимость и структуру карточки, если она была перезаписана
            mealCard.style.display = "";
            // Если элемент потерял внутреннюю структуру (например, при старых патчах), восстановим её
            if (!mealCard.querySelector("#meal-table-container")) {
              mealCard.innerHTML = `
                <div id="meal-table-container" style="margin-top:0.3rem;"></div>
              `;
            }
            mealCard.classList.remove("no-lessons");
          }
        }
      }
      // === Остальные функции без изменений ===
      function getCurrentTimeInKamchatkaContext() {
        const now = new Date();
        const localHours = now.getHours();
        const localMinutes = String(now.getMinutes()).padStart(2, "0");
        const localSeconds = String(now.getSeconds()).padStart(2, "0");
        return `${localHours}:${localMinutes}:${localSeconds}`;
      }
      function getCurrentDayOfWeek() {
        const now = new Date();
        const localOffsetMinutes = now.getTimezoneOffset();
        const kamchatkaOffsetMinutes = 12 * 60;
        const offsetDiffMinutes = kamchatkaOffsetMinutes - -localOffsetMinutes;
        const kamchatkaDate = new Date(
          now.getTime() + offsetDiffMinutes * 60 * 1000
        );
        const day = kamchatkaDate.getDay();
        return day === 0 ? 0 : day;
      }
      function timeToSeconds(timeString) {
        const parts = timeString.split(":").map(Number);
        if (parts.length === 2) return parts[0] * 3600 + parts[1] * 60;
        if (parts.length === 3)
          return parts[0] * 3600 + parts[1] * 60 + parts[2];
        return 0;
      }
      function isTimeBetween(currentTime, startTime, endTime) {
        const now = new Date();
        const localOffsetMinutes = now.getTimezoneOffset();
        const kamchatkaOffsetMinutes = 12 * 60;
        const offsetDiffSeconds =
          (kamchatkaOffsetMinutes - -localOffsetMinutes) * 60;
        const currentTimeSeconds = timeToSeconds(currentTime);
        let kamchatkaEquivalentSeconds =
          (currentTimeSeconds + offsetDiffSeconds) % (24 * 3600);
        if (kamchatkaEquivalentSeconds < 0)
          kamchatkaEquivalentSeconds += 24 * 3600;
        const startSeconds = timeToSeconds(startTime);
        let endSeconds = timeToSeconds(endTime);
        if (endSeconds < startSeconds) endSeconds += 24 * 3600;
        return (
          kamchatkaEquivalentSeconds >= startSeconds &&
          kamchatkaEquivalentSeconds < endSeconds
        );
      }
      function renderFullSchedule() {
        const day = getCurrentDayOfWeek();
        const currentTime = getCurrentTimeInKamchatkaContext();
        const scheduleData = schedule[day];
        function renderShift(shiftKey, containerId) {
          const container = document.getElementById(containerId);
          if (!container || !scheduleData || !scheduleData[shiftKey]) {
            if (container) container.innerHTML = "";
            return;
          }
          container.innerHTML = "";
          scheduleData[shiftKey].forEach((lesson) => {
            const isClassHour = lesson.lesson
              .toLowerCase()
              .includes("классный час");
            const lessonNumberMatch = lesson.lesson.match(/^(\d+)-й урок/);
            let lessonNumber = "";
            if (isClassHour) lessonNumber = "КЛ";
            else if (lessonNumberMatch) lessonNumber = lessonNumberMatch[1];
            const isCurrent = isTimeBetween(
              currentTime,
              lesson.start,
              lesson.end
            );
            const lessonEl = document.createElement("div");
            lessonEl.className = `lesson-item ${isCurrent ? "current" : ""}`;
            lessonEl.innerHTML = `
                    <div class="lesson-number">${lessonNumber}</div>
                    <div class="lesson-time">${lesson.start} - ${lesson.end}</div>
                `;
            container.appendChild(lessonEl);
          });
        }
        renderShift("shift1", "shift1-full");
        renderShift("shift2", "shift2-full");
        // Убираем вкладку питания из развернутого расписания (не показываем meals-full)
        try {
          const mealsContainer = document.getElementById("meals-full");
          if (mealsContainer) {
            const parent = mealsContainer.closest('.shift-schedule');
            if (parent) parent.style.display = 'none';
            mealsContainer.innerHTML = '';
          }
        } catch (e) {
          console.warn("Hide meals tab failed", e);
        }
      }
      function calculateRemainingTime(currentTime, endTime) {
        const now = new Date();
        const localOffsetMinutes = now.getTimezoneOffset();
        const kamchatkaOffsetMinutes = 12 * 60;
        const offsetDiffSeconds =
          (kamchatkaOffsetMinutes - -localOffsetMinutes) * 60;
        const nowSeconds = timeToSeconds(currentTime);
        let kamchatkaEquivalentSeconds =
          (nowSeconds + offsetDiffSeconds) % (24 * 3600);
        if (kamchatkaEquivalentSeconds < 0)
          kamchatkaEquivalentSeconds += 24 * 3600;
        let endSeconds = timeToSeconds(endTime + ":00");
        if (endSeconds < kamchatkaEquivalentSeconds) endSeconds += 24 * 3600;
        if (kamchatkaEquivalentSeconds >= endSeconds) return "0 сек";
        const remainingTotalSeconds = endSeconds - kamchatkaEquivalentSeconds;
        if (remainingTotalSeconds >= 3600) {
          const h = Math.floor(remainingTotalSeconds / 3600);
          const m = Math.ceil((remainingTotalSeconds % 3600) / 60);
          return `${h} ч ${m} мин`;
        } else if (remainingTotalSeconds >= 60) {
          return `${Math.ceil(remainingTotalSeconds / 60)} мин`;
        } else {
          return `${Math.ceil(remainingTotalSeconds)} сек`;
        }
      }
      function formatTimeDifference(diffSeconds) {
        if (diffSeconds <= 0) return "0 мин";
        const days = Math.floor(diffSeconds / 86400);
        diffSeconds %= 86400;
        const hours = Math.floor(diffSeconds / 3600);
        diffSeconds %= 3600;
        const minutes = Math.floor(diffSeconds / 60);
        const parts = [];
        if (days > 0) parts.push(`${days} дн`);
        if (hours > 0) parts.push(`${hours} ч`);
        if (minutes > 0 || parts.length === 0) parts.push(`${minutes} мин`);
        return parts.join(" ") || "0 мин";
      }
      function updateProgressBar(progressBar, currentTime, startTime, endTime) {
        const now = new Date();
        const localOffsetMinutes = now.getTimezoneOffset();
        const kamchatkaOffsetMinutes = 12 * 60;
        const offsetDiffSeconds =
          (kamchatkaOffsetMinutes - -localOffsetMinutes) * 60;
        const nowSeconds = timeToSeconds(currentTime);
        let kamchatkaEquivalentSeconds =
          (nowSeconds + offsetDiffSeconds) % (24 * 3600);
        if (kamchatkaEquivalentSeconds < 0)
          kamchatkaEquivalentSeconds += 24 * 3600;
        const startTotalSeconds = timeToSeconds(startTime);
        let endTotalSeconds = timeToSeconds(endTime);
        if (endTotalSeconds < startTotalSeconds) endTotalSeconds += 24 * 3600;
        const totalDuration = endTotalSeconds - startTotalSeconds;
        const elapsed = kamchatkaEquivalentSeconds - startTotalSeconds;
        if (totalDuration > 0 && elapsed >= 0 && elapsed <= totalDuration) {
          progressBar.style.width = `${(elapsed / totalDuration) * 100}%`;
        } else if (elapsed > totalDuration) {
          progressBar.style.width = "100%";
        } else {
          progressBar.style.width = "0%";
        }
      }
      function findNextLessonTime(
        shiftData,
        currentTime,
        currentDay,
        shiftKey
      ) {
        const now = new Date();
        const localOffsetMinutes = now.getTimezoneOffset();
        const kamchatkaOffsetMinutes = 12 * 60;
        const offsetDiffSeconds =
          (kamchatkaOffsetMinutes - -localOffsetMinutes) * 60;
        const nowSeconds = timeToSeconds(currentTime);
        let kamchatkaEquivalentSeconds =
          (nowSeconds + offsetDiffSeconds) % (24 * 3600);
        if (kamchatkaEquivalentSeconds < 0)
          kamchatkaEquivalentSeconds += 24 * 3600;
        let nextLesson = null;
        let nextLessonDay = currentDay;
        for (const lesson of shiftData) {
          if (timeToSeconds(lesson.start) > kamchatkaEquivalentSeconds) {
            nextLesson = lesson;
            break;
          }
        }
        if (!nextLesson && currentDay < 5) {
          const nextDay = schedule[currentDay + 1];
          if (nextDay?.[shiftKey]?.[0]) {
            nextLesson = nextDay[shiftKey][0];
            nextLessonDay = currentDay + 1;
          }
        }
        if (nextLesson) {
          const [h, m] = nextLesson.start.split(":").map(Number);
          let nextDate = new Date();
          nextDate.setDate(nextDate.getDate() + (nextLessonDay - currentDay));
          nextDate.setHours(h, m, 0, 0);
          nextDate = new Date(nextDate.getTime() - offsetDiffSeconds * 1000);
          let diff = Math.floor((nextDate - now) / 1000);
          if (diff < 0) diff += 86400;
          return formatTimeDifference(diff);
        }
        return null;
      }
      function updateShiftDisplay(
        shiftData,
        lessonNameElement,
        remainingElement,
        startTimeElement,
        endTimeElement,
        progressBar,
        shiftKey
      ) {
        const progressBarContainer = progressBar.parentElement;
        const progressTimeLabels = startTimeElement.parentElement;
        const lessonCard = lessonNameElement.closest(".lesson-card");
        lessonCard.classList.remove("collapsed");
        progressBarContainer.classList.remove("hidden");
        progressTimeLabels.classList.remove("hidden");
        if (!shiftData || shiftData.length === 0) {
          lessonNameElement.textContent = "Нет уроков";
          remainingElement.style.visibility = "hidden";
          startTimeElement.textContent = "";
          endTimeElement.textContent = "";
          progressBar.style.width = "0%";
          progressBarContainer.classList.add("hidden");
          progressTimeLabels.classList.add("hidden");
          lessonCard.classList.add("collapsed");
          return;
        }
        const currentTime = getCurrentTimeInKamchatkaContext();
        const currentLessonIndex = shiftData.findIndex((lesson) =>
          isTimeBetween(currentTime, lesson.start, lesson.end)
        );
        if (currentLessonIndex !== -1) {
          const lesson = shiftData[currentLessonIndex];
          lessonNameElement.textContent = lesson.lesson;
          remainingElement.style.visibility = "visible";
          remainingElement.querySelector(".remaining-text").textContent =
            calculateRemainingTime(currentTime, lesson.end);
          const { startDate, endDate } = getLocalTimes(
            lesson.start,
            lesson.end
          );
          startTimeElement.textContent = `${String(
            startDate.getHours()
          ).padStart(2, "0")}:${String(startDate.getMinutes()).padStart(
            2,
            "0"
          )}`;
          endTimeElement.textContent = `${String(endDate.getHours()).padStart(
            2,
            "0"
          )}:${String(endDate.getMinutes()).padStart(2, "0")}`;
          updateProgressBar(
            progressBar,
            currentTime,
            `${lesson.start}:00`,
            `${lesson.end}:00`
          );
        } else {
          let isBreak = false;
          let nextLesson = null;
          let breakStartTime = null;
          for (let i = 0; i < shiftData.length - 1; i++) {
            const end = timeToSeconds(shiftData[i].end);
            const start = timeToSeconds(shiftData[i + 1].start);
            const nowSec = timeToSeconds(currentTime);
            if (nowSec > end && nowSec < start) {
              isBreak = true;
              nextLesson = shiftData[i + 1];
              breakStartTime = shiftData[i].end;
              break;
            }
          }
          if (isBreak && nextLesson) {
            lessonNameElement.textContent = "Перемена";
            remainingElement.style.visibility = "visible";
            remainingElement.querySelector(".remaining-text").textContent =
              calculateRemainingTime(currentTime, nextLesson.start);
            const { startDate, endDate } = getLocalTimes(
              breakStartTime,
              nextLesson.start
            );
            startTimeElement.textContent = `${String(
              startDate.getHours()
            ).padStart(2, "0")}:${String(startDate.getMinutes()).padStart(
              2,
              "0"
            )}`;
            endTimeElement.textContent = `${String(endDate.getHours()).padStart(
              2,
              "0"
            )}:${String(endDate.getMinutes()).padStart(2, "0")}`;
            updateProgressBar(
              progressBar,
              currentTime,
              `${breakStartTime}:00`,
              `${nextLesson.start}:00`
            );
          } else {
            const timeToNext = findNextLessonTime(
              shiftData,
              currentTime,
              getCurrentDayOfWeek(),
              shiftKey
            );
            lessonNameElement.textContent = timeToNext
              ? `До урока: ${timeToNext}`
              : "Уроки кончились";
            remainingElement.style.visibility = "hidden";
            startTimeElement.textContent = "";
            endTimeElement.textContent = "";
            progressBar.style.width = "0%";
            progressBarContainer.classList.add("hidden");
            progressTimeLabels.classList.add("hidden");
            lessonCard.classList.add("collapsed");
          }
        }
      }
      function getLocalTimes(startTimeStr, endTimeStr) {
        const [sh, sm] = startTimeStr.split(":").map(Number);
        const [eh, em] = endTimeStr.split(":").map(Number);
        const now = new Date();
        const startDate = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate(),
          sh,
          sm
        );
        const endDate = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate(),
          eh,
          em
        );
        const offsetDiffMinutes = 12 * 60 + new Date().getTimezoneOffset();
        startDate.setMinutes(startDate.getMinutes() - offsetDiffMinutes);
        endDate.setMinutes(endDate.getMinutes() - offsetDiffMinutes);
        return { startDate, endDate };
      }
      // === ФОН И ТЕМА (ВЫЗЫВАЕТСЯ ВСЕГДА) ===
      function updateThemeAndBackground() {
        const now = new Date();
        const localOffsetMinutes = now.getTimezoneOffset();
        const kamchatkaOffsetMinutes = 12 * 60;
        const offsetDiffMinutes = kamchatkaOffsetMinutes + localOffsetMinutes;
        const kamchatkaDate = new Date(
          now.getTime() + offsetDiffMinutes * 60 * 1000
        );
        const hour = kamchatkaDate.getHours();
        const body = document.body;
        const html = document.documentElement;
        const themeColorMeta = document.getElementById("themeColor");
        const dayNames = [
          "Воскресенье",
          "Понедельник",
          "Вторник",
          "Среда",
          "Четверг",
          "Пятница",
          "Суббота",
        ];
        document.getElementById("dayOfWeek").textContent =
          dayNames[getCurrentDayOfWeek()];
        let bg, color;
        const isNight = hour < 6 || hour >= 20;
        if (isNight) {
          bg = "#000000";
          color = "#000000";
          removeClouds();
          if (!document.querySelector(".star")) createStars();
          body.classList.add("night-mode");
        } else {
          if (hour < 12) {
            bg = "#927A46";
            color = "#927A46";
          } else if (hour < 17) {
            bg = "#5D827F";
            color = "#5D827F";
          } else if (hour < 18) {
            bg = "#6B7C8E";
            color = "#6B7C8E";
          } else {
            bg = "#4B5B6E";
            color = "#4B5B6E";
          }
          removeStars();
          if (!document.querySelector(".cloud")) createClouds();
          body.classList.remove("night-mode");
        }
        html.style.backgroundColor = bg;
        if (themeColorMeta) themeColorMeta.setAttribute("content", color);
        setTimeout(() => {
          html.style.transition = "background-color 0.5s ease";
        }, 50);
      }
      function updateSchedule() {
        updateThemeAndBackground();
        // Применяем отмену по сменам
        applyNoLessonsReasonToShifts();
        // === ВСЕГДА обновляем смены, у которых уроки ЕСТЬ ===
        const dayOfWeek = getCurrentDayOfWeek();
        const todaySchedule = schedule[dayOfWeek];
        const shifts = [
          {
            name: "lesson1",
            data: todaySchedule?.shift1,
            key: "shift1",
            cancel: lessons1,
          },
          {
            name: "lesson2",
            data: todaySchedule?.shift2,
            key: "shift2",
            cancel: lessons2,
          },
        ];
        shifts.forEach((shift) => {
          const prefix = shift.name;
          const nameEl = document.getElementById(`${prefix}-name`);
          const remEl = document.getElementById(`${prefix}-remaining`);
          const startEl = document.getElementById(`${prefix}-start-time`);
          const endEl = document.getElementById(`${prefix}-end-time`);
          const progEl = document.getElementById(`${prefix}-progress`);
          // Пропускаем, только если смена отменена
          if (shift.cancel !== 0 || !nameEl) return;
          updateShiftDisplay(
            shift.data,
            nameEl,
            remEl,
            startEl,
            endEl,
            progEl,
            shift.key
          );
        });
        // Обновляем карточку питания (только если занятия не отменены у ОБЕИХ смен)
        try {
          if (!(lessons1 !== 0 && lessons2 !== 0)) {
            updateMealDisplay();
          }
        } catch (e) {
          console.warn("Meal update failed", e);
        }
        // renderFullSchedule() — вызываем всегда (для боковой панели)
        renderFullSchedule();
      }
      function createStars() {
        removeStars();
        const container = document.createElement("div");
        container.style.position = "fixed";
        container.style.top = "0";
        container.style.left = "0";
        container.style.width = "100vw";
        container.style.height = "100vh";
        container.style.pointerEvents = "none";
        container.style.zIndex = "1";
        const numStars = 45;
        for (let i = 0; i < numStars; i++) {
          const star = document.createElement("div");
          star.classList.add("star");
          star.style.left = `${Math.random() * 100}vw`;
          star.style.top = `${Math.random() * 100}vh`;
          const size = Math.random() * 2.5 + 1;
          star.style.width = `${size}px`;
          star.style.height = `${size}px`;
          star.style.animationDuration = `${Math.random() * 2 + 1}s`;
          star.style.animationDelay = `${Math.random() * 2}s`;
          container.appendChild(star);
        }
        document.body.appendChild(container);
      }
      function createClouds() {
          // Проверка — если контейнер уже есть, не создаём заново
          if (document.getElementById("cloud-container")) return;
          const isWinter = [12, 1, 2].includes(new Date().getMonth() + 1);
          const container = document.createElement("div");
          container.id = "cloud-container";
          container.style.position = "fixed";
          container.style.top = "0";
          container.style.left = "0";
          container.style.width = "100vw";
          container.style.height = "100vh";
          container.style.pointerEvents = "none";
          container.style.zIndex = "1";
          container.style.overflow = "hidden";
          const screenWidth = window.innerWidth;
          if (!isWinter) {
              // Летний режим (облака)
              const numClouds = Math.max(
                  6,
                  Math.min(
                      20,
                      Math.round(((screenWidth - 400) / (2000 - 400)) * (20 - 6) + 6)
                  )
              );
              for (let i = 0; i < numClouds; i++) {
                  const cloud = document.createElement("div");
                  cloud.classList.add("cloud");
                  const top = Math.random() * 10 + 4;
                  cloud.style.top = `${top}vh`;
                  const baseMin = 60;
                  const baseMax = 50;
                  const baseWidth = Math.random() * baseMax + baseMin;
                  cloud.dataset.baseWidth = baseWidth;
                  const progress = Math.random();
                  cloud.dataset.progress = progress;
                  const initialX = Math.random() * 100;
                  cloud.style.left = `${initialX}vw`;
                  cloud.style.transform = `translateX(0)`;
                  cloud.style.animationDelay = `${-(Math.random() * 100)}s`;
                  let initialOpacity = 0;
                  if (progress >= 0.05 && progress <= 0.95) initialOpacity = 0.7;
                  else if (progress > 0.95)
                      initialOpacity = ((1 - progress) / 0.05) * 0.7;
                  cloud.style.opacity = initialOpacity;
                  container.appendChild(cloud);
              }
          } else {
              // Зимний режим (снег)
              const numSnow = Math.floor(screenWidth / 25);
              for (let i = 0; i < numSnow; i++) {
                  const flake = document.createElement("div");
                  flake.classList.add("snowflake");
                  flake.style.left = `${Math.random() * 100}vw`;
                  flake.style.animationDelay = `${Math.random() * -20}s`;
                  const duration = Math.random() * 10 + 10;
                  flake.style.animationDuration = `${duration}s`;
                  container.appendChild(flake);
              }
          }
          document.body.appendChild(container);
          if (!isWinter) updateClouds();
      }
      function updateClouds() {
        const clouds = document.querySelectorAll(".cloud");
        const screenWidth = window.innerWidth;
        clouds.forEach((cloud) => {
          const baseWidth = parseFloat(cloud.dataset.baseWidth);
          // Размер
          const scale = Math.min(2.8, Math.max(1, screenWidth / 2000 + 0.5));
          const width = baseWidth * scale;
          cloud.style.width = `${width}px`;
          cloud.style.height = `${width * 0.85}px`;
          // Скорость анимации
          const minDuration = 20;
          const maxDuration = 300;
          const duration =
            ((screenWidth - 400) / (2000 - 400)) * (maxDuration - minDuration) +
            minDuration;
          cloud.style.animationDuration = `${Math.max(
            minDuration,
            Math.min(maxDuration, duration)
          )}s`;
        });
      }
      function removeClouds() {
        const container = document.getElementById("cloud-container");
        if (container) container.remove();
      }
      function removeStars() {
        document
          .querySelectorAll('div[style*="position: fixed"] .star')
          .forEach((s) => s.closest("div").remove());
      }
      // Создаём облака при загрузке страницы
      createClouds();
      function renderWeeklySchedule() {
        const slider = document.getElementById("scheduleSlider");
        if (!slider) return;
        slider.innerHTML = "";
        for (let day = 1; day <= 5; day++) {
          const daySchedule = schedule[day];
          const dayEl = document.createElement("div");
          dayEl.className = "day-schedule";
          ["shift1", "shift2"].forEach((shiftKey) => {
            const shiftEl = document.createElement("div");
            shiftEl.className = "shift-schedule";
            shiftEl.innerHTML = `<div class="schedule-index">${
              shiftKey === "shift1" ? "1 смена" : "2 смена"
            }</div>`;
            daySchedule[shiftKey].forEach((lesson) => {
              const lessonEl = document.createElement("div");
              lessonEl.className = "lesson-item";
              lessonEl.innerHTML = `
                        <div class="lesson-time">${lesson.start} - ${lesson.end}</div>
                        <div class="full-lesson-name">${lesson.lesson}</div>
                    `;
              shiftEl.appendChild(lessonEl);
            });
            dayEl.appendChild(shiftEl);
          });
          // Убираем вкладку питания из недельного просмотра (не добавляем meals block)
          // (намеренно пусто)
          slider.appendChild(dayEl);
        }
      }
      function openSchedulePanel() {
        renderWeeklySchedule();
        updateDayDisplay();
        const panel = document.querySelector(".full-schedule-panel");
        if (panel) {
          panel.style.display = "block";
          document.body.style.overflow = "hidden";
          setTimeout(() => panel.classList.add("open"), 10);
        }
      }
      function closeSchedulePanel() {
        const panel = document.querySelector(".full-schedule-panel");
        if (panel) {
          panel.classList.remove("open");
          panel.classList.add("closing");
          document.body.style.overflow = "";
          setTimeout(() => {
            panel.style.display = "none";
            panel.classList.remove("closing");
          }, 300);
        }
      }
      let currentDayIndex = getCurrentDayOfWeek();
      if (currentDayIndex === 0 || currentDayIndex === 6) currentDayIndex = 1;
      function updateDayDisplay() {
        const dayNames = [
          "Воскресенье",
          "Понедельник",
          "Вторник",
          "Среда",
          "Четверг",
          "Пятница",
          "Суббота",
        ];
        const title = document.getElementById("currentDayTitle");
        if (title) title.textContent = dayNames[currentDayIndex];
        const slider = document.getElementById("scheduleSlider");
        if (slider) {
          Array.from(slider.children).forEach((child, i) => {
            child.style.transform = `translateX(-${
              (currentDayIndex - 1) * 100
            }%)`;
          });
        }
      }
      // === ИНИЦИАЛИЗАЦИЯ ===
      createClouds();
      window.addEventListener("resize", updateClouds);
      document.getElementById("prevDay")?.addEventListener("click", () => {
        if (currentDayIndex > 1) {
          currentDayIndex--;
          updateDayDisplay();
        }
      });
      document.getElementById("nextDay")?.addEventListener("click", () => {
        if (currentDayIndex < 5) {
          currentDayIndex++;
          updateDayDisplay();
        }
      });
      document
        .querySelector(".open-full-schedule")
        ?.addEventListener("click", openSchedulePanel);
      document
        .querySelector(".close-panel")
        ?.addEventListener("click", closeSchedulePanel);
      setInterval(updateSchedule, 1000);
      updateSchedule();
      renderFullSchedule();
      // === Деплой ===
      function updateDeployment() {
        const lastDeploymentElement =
          document.getElementById("last-deployment");
        // Получаем информацию о последнем деплое
        fetch(
          "https://api.github.com/repos/Cotoburger/Cotoburger.github.io/deployments",
          {
            headers: { Accept: "application/vnd.github.v3+json" },
          }
        )
          .then((response) => {
            if (!response.ok) {
              throw new Error(`Ошибка HTTP! Статус: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            if (data.length === 0) {
              throw new Error("Нет доступных деплоев");
            }
            const latestDeployment = data[0]; // Берём самый свежий деплой
            const date = new Date(latestDeployment.created_at);
            const formattedDate = date.toLocaleDateString("ru-RU");
            const formattedTime = date.toLocaleTimeString("ru-RU");
            return fetch(latestDeployment.statuses_url, {
              headers: { Accept: "application/vnd.github.v3+json" },
            })
              .then((statusResponse) => {
                if (!statusResponse.ok) {
                  throw new Error(
                    `Ошибка HTTP! Статус: ${statusResponse.status}`
                  );
                }
                return statusResponse.json();
              })
              .then((statuses) => {
                const latestStatus = statuses[0] || { state: "unknown" };
                const statusText =
                  latestStatus.state === "success"
                    ? "OK"
                    : latestStatus.state === "failure"
                    ? "ERR"
                    : "Work";
                if (lastDeploymentElement) {
                  lastDeploymentElement.innerHTML = `Меню взято с сайта школы <br> Изменение кода: ${formattedDate} ${formattedTime} (${statusText})`;
                }
              });
          })
          .catch((error) => {
            console.error("Deployment fetch failure:", error);
            if (lastDeploymentElement) {
              lastDeploymentElement.textContent = "";
            }
          });
      }
      const observer = new IntersectionObserver((entries, entriesObs) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            updateDeployment();
            setInterval(updateDeployment, 90000);
            entriesObs.unobserve(entry.target);
          }
        });
      });
      const target = document.getElementById("last-deployment");
      if (target) observer.observe(target);
    </script>
  </body>
</html>